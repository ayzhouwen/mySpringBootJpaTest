server:
  port: 18080
  tomcat:
    # Tomcat 线程池优化（生产环境核心）
    max-threads: 200        # 最大工作线程数（根据服务器CPU核数调整，建议CPU核数*2+1）
    min-spare-threads: 20   # 最小空闲线程数
    accept-count: 100       # 请求排队数
    max-connections: 10000  # 最大连接数
    connection-timeout: 20000 # 连接超时时间（ms）

spring:
  # 数据库连接池优化（生产用HikariCP，SpringBoot2默认）
  #      url的连接属性
  #      cachePrepStmts=true&\           # 开启PreparedStatement缓存(AI生成我先注释掉，之前没用过)
  #      prepStmtCacheSize=250&\         # 缓存大小(AI生成我先注释掉，之前没用过)
  #      prepStmtCacheSqlLimit=2048&\    # SQL最大长度(AI生成我先注释掉，之前没用过)
  datasource:

#    driver-class-name: com.mysql.cj.jdbc.Driver
    #    url: "jdbc:mysql://10.168.136.128:3306/test1?useUnicode=true&useSSL=false&verifyServerCertificate=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true&rewriteBatchedStatements=true&useServerPrepStmts=true"

    driver-class-name: com.p6spy.engine.spy.P6SpyDriver
    url: "jdbc:p6spy:mysql://10.168.136.128:3306/test1?useUnicode=true&useSSL=false&verifyServerCertificate=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true&rewriteBatchedStatements=true&useServerPrepStmts=true"
    username: root
    password: jcca@123
    # HikariCP 连接池核心配置（生产必配）
    hikari:
      minimum-idle: 10                # 最小空闲连接数（建议=核心线程数）
      maximum-pool-size: 20           # 最大连接数（根据业务QPS调整，不超过MySQL最大连接数）
      idle-timeout: 600000            # 空闲连接超时时间（10分钟）
      connection-timeout: 30000       # 连接获取超时时间（30秒）
      max-lifetime: 1800000           # 连接最大生命周期（30分钟）
      connection-test-query: SELECT 1 # 连接保活检测
      pool-name: JpaDemoHikariPool    # 连接池名称（便于监控）

  # JPA/Hibernate 生产环境优化（保留SQL输出）
  jpa:
    hibernate:
      ddl-auto: none                  # 生产环境禁用自动建表/更新（手动执行SQL脚本）
      naming:
        physical-strategy: org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl # 表名/列名不自动转小写
    show-sql: false                    # 保留SQL输出
    format_sql: false                  # SQL格式化（便于阅读）
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL57Dialect # MySQL5.7方言
        jdbc:
          batch_size: 1              # 【如果用p6spy那么这里必须设置为1，否则不打印insert SQL】开启批量插入/更新（提升批量操作性能）
          batch_versioned_data: true  # 批量版本化数据支持
        order_inserts: true           # 对INSERT语句排序（提升批量插入性能）
        order_updates: true           # 对UPDATE语句排序（提升批量更新性能）
        cache:
          use_second_level_cache: false # 关闭二级缓存（避免缓存一致性问题，按需开启）
        generate_statistics: false    # 关闭统计（生产环境减少开销）
    open-in-view: false               # 关闭Open Session In View（避免长连接和性能问题）

# 日志配置（精细化控制SQL输出，生产环境建议输出到文件）
logging:
  level:
    root: INFO                        # 根日志级别（生产用INFO，减少日志量）
    org.hibernate.SQL: INFO          # 打印SQL（和show-sql配合 DEBUG）
    org.hibernate.type.descriptor.sql.BasicBinder: INFO # 打印SQL参数（便于调试 TRACE）
#    org.springframework.jdbc.core.JdbcTemplate: DEBUG  #打印springjdbc的sql
#    org.springframework.jdbc.core.StatementCreatorUtils: TRACE #打印springjdbc的sql
